---
import { getCollection } from 'astro:content';
import ProjectCard from './ProjectCard.astro';
import ProjectsCloud from './ProjectsCloud.astro';

const all = await getCollection('projects', ({ data }) => !data.draft);
// Featured projects first, then by weight
const projects = all.sort((a, b) => {
  if ((b.data.featured ? 1 : 0) !== (a.data.featured ? 1 : 0)) {
    return (b.data.featured ? 1 : 0) - (a.data.featured ? 1 : 0);
  }
  return (b.data.weight ?? 0) - (a.data.weight ?? 0);
});
---
<style>
  section { margin: 0 auto 4rem; max-width: 1100px; padding: 0 1rem; }
  .panel { margin-top: .5rem; border-radius: 16px; overflow: hidden; background: rgba(255,255,255,.02); border: 1px solid rgba(255,255,255,.15); }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; padding: 1rem; grid-auto-flow: dense; }
</style>

<section id="projects">
  <ProjectsCloud icons={projects} onLabel="Apps" />
  <div class="panel">
    <div class="grid">
      {projects.map((p) => <ProjectCard project={p} />)}
    </div>
  </div>
</section>


