---
import { Icon } from 'astro-icon/components'
import { getCollection } from 'astro:content';
import ProjectCard from './ProjectCard.astro';
import ProjectsCloud from './ProjectsCloud.astro';
import Footer from './Footer.astro';
import SiteFooter from './SiteFooter.astro';

const all = await getCollection('projects', ({ data }) => !data.draft);
// Featured projects first, then by weight
const projects = all.sort((a, b) => {
  if ((b.data.featured ? 1 : 0) !== (a.data.featured ? 1 : 0)) {
    return (b.data.featured ? 1 : 0) - (a.data.featured ? 1 : 0);
  }
  return (b.data.weight ?? 0) - (a.data.weight ?? 0);
});
---
<style>
  section { margin: 0 auto 4rem; max-width: 1100px; padding: 0 1rem; }
  .panel { margin-top: 15vh; border-radius: 16px; overflow: hidden; background: rgba(255,255,255,.02); border: 1px solid rgba(255,255,255,.15); position: relative; z-index: 3; }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; padding: 1rem; grid-auto-flow: dense; }
  .grid > * { min-width: 0; }
  @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

  .realms-intro { text-align: center; margin: 4rem auto 3rem; max-width: 700px; color: #d8d8d8; line-height: 1.7; }
  .realms-title { font-size: 1.6rem; margin-bottom: 0.75rem; background: linear-gradient(90deg, #8b7af1, #3bc6c9); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .realms-text { margin-bottom: 1rem; }
  /* Shrink-wrap to content and center the whole block by the longest line */
  .realms-list {
    display: grid;
    gap: .5rem;
    margin: 0 auto;
    width: fit-content;            /* shrink to longest row */
    max-width: 700px;              /* donâ€™t exceed desired width */
    justify-items: start;          /* keep rows left-aligned inside */
  }
  /* Two-column grid: fixed icon column + flexible text column */
  .realm {
    display: grid;
    grid-template-columns: 1.4em auto;
    align-items: center;           /* vertically center icon with text block */
    column-gap: .6rem;
    font-size: 1rem;
  }
  .realm .realm-icon { align-self: center; display: inline-block; }
  .realm span { max-width: 650px; align-self: center; }

  /* On narrow screens, prefer leading (top) alignment so wrapped lines start at the same top edge */
  @media (max-width: 640px) {
    /* Nudge icon down to visually align with first line when text wraps */
    .realm { align-items: start; text-align: start; }
    .realm .realm-icon {
      display: inline-block;
      line-height: 1;
      margin-top: .28em; /* optical alignment tweak for wrapped text */
    }
    .realm span { display: inline; }
  }
  .realm-icon { width: 1.2em; height: 1.2em; flex-shrink: 0; opacity: .9; filter: drop-shadow(0 0 4px rgba(139,122,241,.4)); }
  .realm-icon--scale { color: #6e7ff2; filter: drop-shadow(0 0 4px rgba(110,127,242,.4)); }
  .realm-icon--independent { color: #8b7af1; filter: drop-shadow(0 0 4px rgba(139,122,241,.5)); }
  .realm-icon--personal { color: #3bc6c9; filter: drop-shadow(0 0 4px rgba(59,198,201,.45)); }
  .realm-label { color: #ffffff; letter-spacing: .02em; }
  .realm span { color: #e0e0e0; }
</style>

<section id="projects">
  <ProjectsCloud icons={projects} onLabel="Apps" />
  <section class="realms-intro">
    <h2 class="realms-title">How I Build</h2>
    <p class="realms-text">I build software in three realms:</p>
    <div class="realms-list">
      <div class="realm">
        <Icon name="mdi:domain" class="realm-icon realm-icon--scale" />
        <span><strong class="realm-label">At scale:</strong> systems used by millions (Square, WillowTree).</span>
      </div>
      <div class="realm">
        <img src="public_html/images/company-logos/robot-hand.png" alt="Robot Hand" class="realm-icon realm-icon--independent" style="filter:brightness(0) invert(1)" />
        <span><strong class="realm-label">Independently:</strong> as founder of <strong>Robot Hand, LLC</strong>.</span>
      </div>
      <div class="realm">
        <Icon name="mdi:test-tube" class="realm-icon realm-icon--personal" />
        <span><strong class="realm-label">Personal:</strong> small, well-crafted apps and tools that keep me curious.</span>
      </div>
    </div>
  </section>
  <div class="panel">
    <div class="grid">
      {projects.map((p) => <ProjectCard project={p} />)}
    </div>
  </div>
  <Footer />
  <SiteFooter />
</section>


