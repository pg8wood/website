---
import { Icon } from 'astro-icon/components'
import { getCollection } from 'astro:content';
import ProjectCard from './ProjectCard.astro';
import ProjectsCloud from './ProjectsCloud.astro';

const all = await getCollection('projects', ({ data }) => !data.draft);
// Featured projects first, then by weight
const projects = all.sort((a, b) => {
  if ((b.data.featured ? 1 : 0) !== (a.data.featured ? 1 : 0)) {
    return (b.data.featured ? 1 : 0) - (a.data.featured ? 1 : 0);
  }
  return (b.data.weight ?? 0) - (a.data.weight ?? 0);
});
---
<style>
  section { margin: 0 auto 4rem; max-width: 1100px; padding: 0 1rem; }
  .panel { margin-top: 15vh; border-radius: 16px; overflow: hidden; background: rgba(255,255,255,.02); border: 1px solid rgba(255,255,255,.15); position: relative; z-index: 3; }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; padding: 1rem; grid-auto-flow: dense; }
  .grid > * { min-width: 0; }
  @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

  .realms-intro { text-align: center; margin: 4rem auto 2rem; max-width: 750px; line-height: 1.7; color: #e0e0e0; }
  .realms-title { font-size: 1.6rem; margin-bottom: 0.75rem; background: linear-gradient(90deg, #8b7af1, #3bc6c9); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
</style>

<section id="projects">
  <ProjectsCloud icons={projects} onLabel="Apps" />
  <section class="realms-intro">
    <h2 class="realms-title">How I Build</h2>
    <p class="realms-body">
      I build software in three realms:
      <br />
      <Icon name="mdi:domain" style="width:16px;height:16px;vertical-align:middle;margin-left:.25rem" /> <strong>At scale</strong>: systems used by millions (Square, WillowTree) <br />
      <img src="public_html/images/company-logos/robot-hand.png" alt="Robot Hand" style="width:16px;height:16px;vertical-align:middle;filter:brightness(0) invert(1);margin-left:.25rem;margin-right:.1rem" /><strong>Independent</strong>: as founder of <strong>Robot Hand, LLC</strong>.<br />
      <Icon name="mdi:test-tube" style="width:16px;height:16px;vertical-align:middle;margin-left:.25rem" /> <strong>Personal</strong>: small, wellâ€‘crafted apps and tools that keep me curious
    </p>
  </section>
  <div class="panel">
    <div class="grid">
      {projects.map((p) => <ProjectCard project={p} />)}
    </div>
  </div>
</section>


